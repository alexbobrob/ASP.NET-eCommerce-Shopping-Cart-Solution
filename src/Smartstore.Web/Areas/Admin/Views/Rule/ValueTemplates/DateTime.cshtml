@model IRuleExpression

@{
    var id = "rule-value-" + Model.Id;
    var format = (Model.Descriptor.Metadata.Get("DateTimeFormat") as string).NullEmpty() ?? "L LT";
    var pickTime = format == "L LT";
    var timeOnly = format == "LT";
    var iconClass = timeOnly ? "fa-clock" : "fa-calendar-alt";

    DateTime? value = null;
    if (Model.Value != null)
    {
        value = Convert.ToDateTime(Model.Value, System.Globalization.CultureInfo.CurrentCulture);
        value = value.ToLocalTime();
    }

    var strValue = string.Empty;
    if (value.HasValue && value.Value > DateTime.MinValue)
    {
        strValue = timeOnly
            ? value.Value.ToShortTimeString()
            : (pickTime ? value.Value.ToString() : value.Value.ToShortDateString());
    }
}

<div class="date datetimepicker-group" id="@id-parent" data-date="@strValue" data-target-input="nearest" style="display: flex; flex-grow: 1;">
    <input asp-for="@id" value="@strValue" class="form-control datetimepicker-input" data-target="#@(id)-parent" data-format="@format" />
	<div class="input-group-append input-group-addon" data-target="#@(id)-parent" data-toggle="datetimepicker">
		<span class="input-group-text"><i class="far @iconClass"></i></span>
	</div>
</div>

<script sm-target-zone="scripts" data-origin="rule-values">
    $(function () {
        var dtPicker = $('#@(id)-parent');
        dtPicker.datetimepicker({ format: '@(format)', useCurrent: false, locale: moment.locale() });
        dtPicker.on('change.datetimepicker', Smartstore.Admin.Rules.onRuleValueChanged);
	});
</script>