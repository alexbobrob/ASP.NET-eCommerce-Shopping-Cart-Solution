@using Smartstore.Licensing
@using Smartstore.Admin.Models.Modularity

@model LicenseModuleModel

@{
    Layout = null;
}

<form method="post" asp-action="LicenseModule" asp-controller="Module" asp-route-systemName="@Model.SystemName" data-module="@Model.SystemName"
      data-resetcheckurl="@Url.Action("LicenseResetStatusCheck", "Module", new { systemName = Model.SystemName })">

    <div sm-if="Model.InvalidDataStoreId != 0" class="alert alert-warning">
        <p>@T("Admin.Configuration.Plugins.LicensingInvalidStoreUrl")</p>
        <div>
            <a asp-action="Edit" asp-controller="Store" asp-route-id="@Model.InvalidDataStoreId" class="btn btn-warning">
                <span>@T("Admin.Common.Change")</span>
            </a>
        </div>
    </div>

    <div sm-if="Model.InvalidDataStoreId == 0" class="adminContent">
        @for (int i = 0; i < Model.StoreLicenses.Count; ++i)
        {
            var storeLicense = Model.StoreLicenses[i];
            var keyAttributes = new AttributeDictionary { ["autocomplete"] = "new-password" };
            if (storeLicense.LicenseLabel.LicenseState == LicensingState.Licensed && storeLicense.LicenseKey.IsEmpty() && !storeLicense.LicenseLabel.HideLabel)
            {
                keyAttributes.Add("disabled", "disabled");
            }
            <div class="adminRow">
                <div class="admin-config-group" attr-class='(i > 0, "mt-2")'>
                    <div class="title fs-h6">
                        <span>
                            @storeLicense.StoreName
                        </span>
                        <span class="license-label ml-2">
                            <partial name="_LicenseLabel" model="storeLicense.LicenseLabel" />
                        </span>
                    </div>
                </div>
            </div>
            <div class="adminRow">
                <div class="adminTitle">
                    <smart-label asp-for="StoreLicenses[i].LicenseKey"></smart-label>
                </div>
                <div class="adminData">
                    <input type="hidden" asp-for="StoreLicenses[i].StoreId" />
                    <input type="hidden" asp-for="StoreLicenses[i].StoreUrl" />
                    <input asp-for="StoreLicenses[i].LicenseKey" attrs="keyAttributes" />
                </div>
            </div>
            <div class="adminRow">
                <div class="adminTitle">
                    <div class="ctl-label">
                        <label>@T("Common.For", "")</label>
                    </div>
                </div>
                <div class="adminData">
                    <div class="form-control-plaintext">
                        <span>@storeLicense.StoreUrl</span>
                        <a asp-action="Edit" asp-controller="Store" asp-route-id="@storeLicense.StoreId">
                            @T("Admin.Common.Change")
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
</form>
